---
import BaseLayout from './Layout.astro'; // Using the same base layout as the blog
import FeaturedImage from '../components/FeaturedImage.astro';
import { Image } from 'astro:assets';

// Define the base part data structure
interface PartData {
  title: string;
  description: string;
  partNumber: string;
  heroImage: any;
  isShopify?: boolean;
  price?: string;
  currency?: string;
  variantId?: string;
  shopDomain?: string;
}

// Use the custom interface for Props
type Props = PartData;

const { 
  title, 
  description, 
  partNumber, 
  heroImage, 
  isShopify = false, 
  price, 
  currency,
  variantId,
  shopDomain
} = Astro.props;

// Create checkout URL for Shopify products
let checkoutUrl = '';
if (isShopify && variantId && shopDomain) {
  // Format: https://{shop-domain}/cart/{variant-id}:1
  // The ":1" at the end represents the quantity
  checkoutUrl = `https://${shopDomain}/cart/${variantId.replace('gid://shopify/ProductVariant/', '')}:1`;
}
---

<BaseLayout title={title} description={description}>
  <style>
    /* Styles are now consistent with BlogPost.astro */
    main {
      width: calc(100% - 2em);
      max-width: 100%;
      margin: 0;
    }
    .hero-image {
      width: 100%;
      padding: 0 16px;
    }
    .hero-image img {
      display: block;
      margin: 0 auto;
      border-radius: 12px;
      box-shadow: var(--box-shadow);
    }
    .prose {
      width: 720px;
      max-width: calc(100% - 2em);
      margin: auto;
      padding: 1em;
      color: white;
    }
    .title {
      margin-bottom: 1em;
      padding: 1em 0;
      text-align: center;
      line-height: 1;
    }
    .title h1 {
      margin: 0 0 0.5em 0;
    }
    .part-number {
      font-style: italic;
      color: #a0a0a0;
      margin-bottom: 0.5em;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 24px !important;
    }
    .part-number {
      color: var(--accent);
    }
    /* Shopify-specific styles */
    .price {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--accent);
      margin-bottom: 1rem;
    }
    .shopify-buy-section {
      margin-top: 2rem;
      text-align: center;
    }
    .buy-button {
      background-color: var(--accent);
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      font-weight: bold;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.2s;
      display: inline-block;
      text-decoration: none;
    }
    .buy-button:hover {
      background-color: var(--accent-dark);
    }
  </style>
  <article>
    <FeaturedImage>
      {heroImage && (
        isShopify 
          ? <img src={heroImage} alt={title} width="720" height="360" class="w-full h-auto rounded-xl" /> 
          : <Image width={720} height={360} src={heroImage} alt={title} />
      )}
    </FeaturedImage>
    <div class="prose">
      <div class="title">
        <div class="part-number">Part #: {partNumber}</div>
        <h1>{title}</h1>
        {isShopify && price && currency && (
          <div class="price">
            {new Intl.NumberFormat('en-US', {
              style: 'currency',
              currency: currency
            }).format(parseFloat(price))}
          </div>
        )}
        <p>{description}</p>
        <hr />
      </div>
      <slot />

      {isShopify && checkoutUrl && (
        <div class="shopify-buy-section">
          <a href={checkoutUrl} class="buy-button" target="_blank" rel="noopener noreferrer">
            Buy Now
          </a>
        </div>
      )}
    </div>
  </article>
</BaseLayout>
